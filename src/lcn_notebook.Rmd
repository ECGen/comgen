---
title: "LCN: Lichen interaction network study"
author: MK Lau
---

<!-- 
rmarkdown::render("./src/lcn_notebook.Rmd", 
	output_format = "pdf_document", 
	output_dir = "./results") 

rmarkdown::render("./src/lcn_notebook.Rmd", 
	output_format = "md_document", 
	output_dir = "./results") 
-->


```{r load_data, eval = TRUE, cache = TRUE}
source("./R/packages.R")
source("./R/functions.R")

```


# Results 

```{r results, cache = TRUE}

### REML
## Create a list to generate a results table
h2.tab <- matrix("", 1, 4)
colnames(h2.tab) <- c("Response", "H2", "R2", "p-value")

## Total cover ~ genotype
ptc.reml <- lme4::lmer(I(PC^(1 / 2)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
ptc.reml.pval <- RLRsim::exactRLRT(ptc.reml)
fligner.test(onc.dat$PC^(1 / 2), onc.dat$geno)
shapiro.test(residuals(ptc.reml))
ptc.reml.result <- c(
  "Percent Lichen Cover",
  H2(ptc.reml, g = onc.dat$geno),
  R2(ptc.reml),
  ptc.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, ptc.reml.result)

## Species richness ~ genotype
spr.reml <- lme4::lmer(I(SR^(1 / 2)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
spr.reml.pval <- RLRsim::exactRLRT(spr.reml)
spr.reml.pval
shapiro.test(residuals(spr.reml))
fligner.test(onc.dat$SR^(1 / 2), onc.dat$geno)
spr.reml.result <- c(
  "Lichen Species Richness",
  H2(spr.reml, g = onc.dat$geno),
  R2(spr.reml),
  spr.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, spr.reml.result)

## Bark roughness REML
prb.reml <- lme4::lmer(I(BR^(1 / 2)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
prb.reml.pval <- RLRsim::exactRLRT(prb.reml)
fligner.test(onc.dat$BR^(1 / 2), onc.dat$geno)
shapiro.test(residuals(prb.reml))
prb.reml.result <- c(
  "Percent Rough Bark",
  H2(prb.reml, g = onc.dat$geno),
  R2(prb.reml),
  prb.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, prb.reml.result)

## pH ~ genotype
ph.reml <- lme4::lmer(I(pH^(1 / 2)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
ph.reml.pval <- RLRsim::exactRLRT(ph.reml)
fligner.test(log(onc.dat$pH), onc.dat$geno)
shapiro.test(residuals(ph.reml))
ph.reml.result <- c(
  "pH",
  H2(ph.reml, g = onc.dat$geno),
  R2(ph.reml),
  ph.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, ph.reml.result)

## condensed tannins  REML
ct.reml <- lme4::lmer(I(CT^(1 / 4)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
ct.reml.pval <- RLRsim::exactRLRT(ct.reml)
fligner.test(onc.dat$CT^(1 / 4), onc.dat$geno)
shapiro.test(residuals(ct.reml))
ct.reml.result <- c(
  "Condensed Tannins (CT)",
  H2(ct.reml, g = onc.dat$geno),
  R2(ct.reml),
  ct.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, ct.reml.result)

## CN ratio REML
cnr.reml <- lme4::lmer(I(CN^(1)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
cnr.reml.pval <- RLRsim::exactRLRT(cnr.reml)
fligner.test(onc.dat$CN^(1 / 1), onc.dat$geno)
shapiro.test(residuals(cnr.reml))
cnr.reml.result <- c(
  "Carbon-Nitrogen (CN) Ratio",
  H2(cnr.reml, g = onc.dat$geno),
  R2(cnr.reml),
  cnr.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, cnr.reml.result)

## Correlations among metrics
cor.test(onc.dat[, "SR"], onc.dat[, "PC"], data = onc.dat)

## Were these correlated with bark roughness?
ptc.prb.lm <- lm(I(PC^(1 / 2)) ~ I(BR^(1 / 2)), data = onc.dat)
summary(ptc.prb.lm)
fligner.test(onc.dat$PC, onc.dat$BR)
shapiro.test(residuals(ptc.prb.lm))

spr.prb.lm <- lm(I(SR^(1)) ~ I(BR^(1 / 2)), data = onc.dat)
summary(spr.prb.lm)
fligner.test(onc.dat$SR^(1), onc.dat$BR)
shapiro.test(residuals(spr.prb.lm))

## COM ~ genotype + Bark roughness + PTC + SPR
set.seed(2)
rcom.ng.perm <- vegan::adonis2(onc.com.rel^(1 / 1) ~ BR + PC + SR,
  data = onc.dat, perm = 10000, mrank = TRUE
)
set.seed(2)
rcom.perm <- vegan::adonis2(onc.com.rel^(1 / 1) ~ geno + BR + PC + SR,
  data = onc.dat, perm = 10000, mrank = TRUE
)
set.seed(2)
com.ng.perm <- vegan::adonis2(onc.com^(1 / 1) ~ BR + PC + SR,
  data = onc.dat, perm = 10000, mrank = TRUE
)
set.seed(2)
com.perm <- vegan::adonis2(onc.com^(1 / 1) ~ geno + BR + PC + SR,
  data = onc.dat, perm = 10000, mrank = TRUE
)
h2.tab[4, "p-value"] <- unlist(rcom.perm)["Pr(>F)1"]
h2.tab[4, "H2"] <- H2(rcom.perm, g = onc.dat$geno)
h2.tab[4, "R2"] <- R2(rcom.perm)
h2.tab[4, "Response"] <- "Lichen Community Composition"

## Is network similarity correlated with community composition?
ecodist::mantel(cn.d.onc ~ vegdist(onc.com.rel), mrank = TRUE)
spr.d <- dist(onc.dat$SR)
ptc.d <- dist(onc.dat$PC)
prb.d <- dist(onc.dat$BR)
### rough -> cover -> rich -> net
ecodist::mantel(cn.d.onc ~ vegdist(onc.com.rel) + 
                  spr.d + ptc.d + prb.d, mrank = TRUE)

## Mantels
ecodist::mantel(cn.mu.d.onc ~ onc.com.mu.d)

## Was lichen network similarity determined by genotype?
set.seed(1234)
cn.perm <- vegan::adonis(cn.d.onc.na ~ geno + BR + pH + CN + CT + PC + SR + SE,
                          by = "term",
                          data = na.omit(onc.dat),
                          permutations = 10000
                          )

cn.perm.ng <- vegan::adonis2(cn.d.onc ~ BR + PC + SR,
  data = onc.dat, permutations = 10000, mrank = TRUE
)
cn.perm.ng
cn.perm
h2.tab[5, "p-value"] <- as.matrix(cn.perm)[1, "Pr(>F)"]
h2.tab[5, "H2"] <- H2(cn.perm, g = onc.dat[, "geno"], perm = 10000)
h2.tab[5, "R2"] <- R2(cn.perm)
h2.tab[5, "Response"] <- "Lichen Network"
# db rda for network similarity
dbr.cn.geno <- vegan::dbrda(cn.d.onc ~ geno, 
                            data = onc.dat, 
                            distance = "bray")
anova(dbr.cn.geno, permutations = 5000)
H2(dbr.cn.geno)

## What aspects of networks explained the similiarity?
## L = number of edges, LD = link density, C = connectivity,
## dcen = degree centrality
link.reml <- lme4::lmer(I(log(L + 0.00000001)) ~ (1 | geno),
  data = onc.dat, REML = TRUE
)
link.reml.pval <- RLRsim::exactRLRT(link.reml, nsim = 50000)
fligner.test(log(onc.dat$L + 0.0000001), onc.dat$geno)
shapiro.test(residuals(link.reml))
link.reml.result <- c(
 "Number of Network Links",
 H2(link.reml, g = onc.dat$geno),
 R2(link.reml),
 link.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, link.reml.result)

# network centrality
cen.reml <- lme4::lmer(I(Cen^(1 / 2)) ~ (1 | geno),
  data = onc.dat, REML = TRUE
)
cen.reml.pval <- RLRsim::exactRLRT(cen.reml, nsim = 50000)
fligner.test(onc.dat$L^(1 / 1), onc.dat$geno)
shapiro.test(residuals(cen.reml))
cen.reml.result <- c(
 "Network Centrality",
 H2(cen.reml, g = onc.dat$geno),
 R2(cen.reml),
 cen.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, cen.reml.result)

# network modularity
mod.reml <- lme4::lmer(I(onc.ns[, "mod.lik"]^(1 / 4)) ~ (1 | geno),
  data = onc.dat, REML = TRUE
)
mod.reml.pval <- RLRsim::exactRLRT(mod.reml)
fligner.test(onc.ns[, "mod.lik"]^(1 / 4), onc.dat$geno)
shapiro.test(residuals(mod.reml))
mod.reml.result <- c(
 "Network Modularity",
 H2(mod.reml, g = onc.dat$geno),
 R2(mod.reml),
 mod.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, mod.reml.result)

## Added diversity and evenness

## Species diversity ~ genotype
spd.reml <- lme4::lmer(I(SD^(1 / 2)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
spd.reml.pval <- RLRsim::exactRLRT(spd.reml)
shapiro.test(residuals(spd.reml))
fligner.test(onc.dat$SD^(1 / 2), onc.dat$geno)
spd.reml.result <- c(
 "Lichen Species Diversity",
 H2(spd.reml, g = onc.dat$geno),
 R2(spd.reml),
 spd.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, spd.reml.result)

## Species diversity ~ genotype
spe.reml <- lme4::lmer(I(SE^(1 / 4)) ~ (1 | geno),
  data = na.omit(onc.dat), REML = TRUE
)
spe.reml.pval <- RLRsim::exactRLRT(spe.reml)
shapiro.test(residuals(spe.reml))
fligner.test(onc.dat$SD^(1 / 2), onc.dat$geno)
spe.reml.result <- c(
 "Lichen Species Evenness",
 H2(spe.reml, g = onc.dat$geno),
 R2(spe.reml),
 spe.reml.pval$"p.value"
)
h2.tab <- rbind(h2.tab, spe.reml.result)

# network stats in relation to other variables
L.aov <- aov(I(log(L + 0.000001)) ~ BR + PC + SR, data = onc.dat)
summary(L.aov)
shapiro.test(residuals(L.aov))
cen.aov <- aov(I(Cen^(1 / 2)) ~ BR + PC + SR, data = onc.dat)
summary(cen.aov)
shapiro.test(residuals(cen.aov))

# are these metrics correlated with network similarity
L.d <- dist(onc.dat$L)
cen.d <- dist(onc.dat$Cen)
mod.d <- dist(cn.mod.onc)
cn.L.cen.perm <- adonis2(cn.d.onc ~ L + Cen, 
                         data = onc.dat, 
                         mrank = TRUE)

## Are there patterns in the centrality of individual lichen species?
sppcen.test <- apply(cen.spp[, apply(cen.spp, 2, sum) >= 2], 2, 
                     function(x) {
                       lme4::lmer(I(x^(1 / 2)) ~ (1 | geno), 
                                  data = na.omit(onc.dat), 
                                  REML = TRUE)
                     })
sppcen.pval <- lapply(sppcen.test, RLRsim::exactRLRT)
sppcen.tab <- do.call(rbind, lapply(sppcen.pval, function(x) {
  c(x[["statistic"]], x[["p.value"]])
}))
sppcen.h2 <- round(unlist(lapply(sppcen.test, H2)), 3)
sppcen.h2

## Mean centrality of species
sort(apply(cen.spp, 2, mean), decreasing = TRUE)
summary(aov(value ~ X2, data = melt(cen.spp)))
TukeyHSD(aov(value ~ X2, data = melt(cen.spp)))
apply(cen.spp, 2, sd) / sqrt(nrow(cen.spp))



## Lichen size distribution
## X. gallericulata thalli are about 0.22 +/- 0.003 cm^2 on average
## with an average median size of 0.12 +/- 0.001 cm^2
## and, size does not vary significantly with genotype.
xgs.reml <- lme4::lmer(I(mean.thallus) ~ (1 | geno),
  data = xgs.data[xgs.data$geno %in%
    names(which(table(xgs.data$geno) > 2)), ],
  REML = TRUE
)
xgs.median.reml <- lme4::lmer(median.thallus ~ (1 | geno),
  data = xgs.data[xgs.data$geno %in%
    names(which(table(xgs.data$geno) > 2)), ],
  REML = TRUE
)
RLRsim::exactRLRT(xgs.reml)
RLRsim::exactRLRT(xgs.median.reml)
fligner.test(xgs.data$mean.thallus, xgs.data$geno)
fligner.test(xgs.data$median.thallus, xgs.data$geno)
mean(xgs.data$mean.thallus)
sd(xgs.data$mean.thallus) / (length(xgs.data$mean.thallus) - 1)
mean(xgs.data$median.thallus)
sd(xgs.data$median.thallus) / (length(xgs.data$median.thallus) - 1)
# ONC and Wild Stand (Uintah)
all.dat <- rbind(
  wild.dat[, c("BR", "PC", "SR", "L", "Cen")],
  onc.dat[, c("BR", "PC", "SR", "L", "Cen")]
)
# Network distances
cn.all <- cn.wild
for (i in 1:length(cn.wild)) {
  cn.all[[i]] <- cn.wild[[i]][
    match(rownames(cn.onc[[1]]), rownames(cn.wild[[i]])),
    match(colnames(cn.onc[[1]]), colnames(cn.wild[[i]]))
  ]
}
cn.all <- append(cn.all, cn.onc)
cn.d.all <- distNet(cn.all, method = "bc")
cn.nms.geno <- c(rep("wild", length(cn.wild)), onc.geno)
if (!exists("cn.nms.all")) {
  set.seed(12345)
  cn.nms.all <- nmds.min(nmds(cn.d.all, 2, 2))
  vec.all <- envfit(cn.nms.all, all.dat)
  # jitter identical points
  cn.nms.all[cn.nms.geno == "H10", ] <- cn.nms.all[
    cn.nms.geno == "H10", ] - 0.2
}

```


# Tables

```{r h2_table, results = "asis"}

h2.tab[, "H2"] <- round(as.numeric(h2.tab[, "H2"]), digits = 5)
h2.tab[, "R2"] <- round(as.numeric(h2.tab[, "R2"]), digits = 5)
h2.tab[, "p-value"] <- round(as.numeric(h2.tab[, "p-value"]), 
                             digits = 5)
h2.tab <- h2.tab[order(h2.tab[, "H2"], decreasing = TRUE), ]
h2.xtab <- xtable::xtable(h2.tab,
  caption =
    "Genotypic effects of cottonwood trees on the associated lichen community.",
  label = "tab:h2_table"
)
print(h2.xtab,
  type = "latex",
  include.rownames = FALSE,
  include.colnames = TRUE
)

```

```{r write_h2_table, results = "hide", echo = FALSE}

print(h2.xtab,
  type = "latex",
  file = "../results/h2_table.tex",
  include.rownames = FALSE,
  include.colnames = TRUE
)
```


```{r com_ng_perm_table, results = "asis"}

# community permanova
rcom.ng.perm.xtab <- xtable::xtable(rcom.ng.perm,
  caption =
    "PerMANOVA Pseudo-F Table: predictors of community similarity.",
  label = "tab:com_ng_perm"
)
print(rcom.ng.perm.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_com_ng_perm_table, results = "hide", echo = FALSE}

print(rcom.ng.perm.xtab,
  type = "latex",
  file = "../results/com_ng_perm_table.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r rcom_perm, results = "asis"}

rcom.perm.xtab <- xtable::xtable(rcom.perm,
  caption =
    "PerMANOVA Pseudo-F Table: predictors of community similarity.",
  label = "tab:rcom_perm"
)
print(rcom.perm.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_rcom_perm, results = "hide", echo = FALSE}

print(rcom.perm.xtab,
  type = "latex",
  file = "../results/rcom_perm.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r cn_perm_ng, results = "asis"}

# network permanova
cn.perm.ng.xtab <- xtable::xtable(cn.perm.ng,
  caption =
    "PerMANOVA Pseudo-F Table: predictors of network similarity.",
  label = "tab:cn_perm_ng"
)
print(cn.perm.ng.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_cn_perm_ng, results = "hide", echo = FALSE}

print(cn.perm.ng.xtab,
  type = "latex",
  file = "../results/cn_perm_ng.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r cn_perm, results = "asis"}

cn.perm.xtab <- xtable::xtable(cn.perm,
  caption =
    "PerMANOVA Pseudo-F Table: predictors of network similarity.",
  label = "tab:cn_perm"
)
print(cn.perm.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_cn_perm, results = "hide", echo = FALSE}

print(cn.perm.xtab,
  type = "latex",
  file = "../results/cn_perm.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r L_aov, results = "asis"}

# network metrics anova
L.aov.xtab <- xtable::xtable(L.aov,
  caption =
    "ANOVA F Table: predictors of the number of network links.",
  label = "tab:L_aov"
)
print(L.aov.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_L_aov, results = "hide", echo = FALSE}

print(L.aov.xtab,
  type = "latex",
  file = "../results/L_aov.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r cen_aov, results = "asis"}

cen.aov.xtab <- xtable::xtable(cen.aov,
  caption =
    "ANOVA F Table showing the predictors of network centralization.",
  label = "tab:cen_aov"
)
print(cen.aov.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_cen_aov, results = "hide", echo = FALSE}

print(cen.aov.xtab,
  type = "latex",
  file = "../results/cen_aov.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r cn_L_cen_perm, results = "asis"}

# networks and network metrics
# permanova
cn.L.cen.perm.xtab <- xtable::xtable(cn.L.cen.perm,
  caption =
    "PerMANOVA Pseudo-F Table: predictors of network similarity.",
  label = "tab:cn_L_cen_perm"
)
print(cn.L.cen.perm.xtab,
  type = "latex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

```{r write_cn_L_cen_perm, results = "hide", echo = FALSE}

print(cn.L.cen.perm.xtab,
  type = "latex",
  file = "../results/cn_L_cen_perm.tex",
  include.rownames = TRUE,
  include.colnames = TRUE
)
```

# Plots

## Figure: Genotype barplots Community composition NMDS with vectors 
```{r com_chplot_onc, height = 5, width = 5}

par(mfrow = c(1, 1), mar = c(5.1, 4.1, 4.1, 2.1) / 1)
chp.coord <- ch.plot(ord.com[, 1:2], onc.geno,
  cex = 2, mu.pch = 19,
  pt.col = "white",
  bar.col = "darkgrey"
)
text(chp.coord, labels = rownames(chp.coord))
plot(vec.com, col = "black", lwd = 7)
```

## Figure: Lichen networks
```{r cn_onc, height = 8, width = 8}

par(mfrow = c(2, 2), mar = c(0, 0.1, 1.0, 0.1))
set.seed(123)
net.col <- sign(meanNet(cn.mu.onc))
net.col[net.col == -1] <- 2
net.col[net.col == 1] <- 1
net.elwd <- (abs(meanNet(cn.mu.onc)) * 10)^2
coord <- gplot(abs(meanNet(cn.mu.onc)),
  gmode = "digraph",
  displaylabels = TRUE,
  edge.lwd = net.elwd,
  edge.col = net.col,
  vertex.col = "black",
  vertex.cex = 0.5,
  arrowhead.cex = 0.5,
  label.cex = 1,
  main = "All Genotypes"
)
cn.mu.plot <- cn.mu.onc[names(cn.mu.onc) %in%
  c("996", "WC5", "1008")]
cn.mu.plot <- cn.mu.plot[
  order(unlist(lapply(
    cn.mu.plot,
    function(x) sum(abs(sign(x)))
  )))
]
for (i in 1:length(cn.mu.plot)) {
  net.col <- sign(cn.mu.plot[[i]])
  net.col[net.col == -1] <- 2
  net.col[net.col == 1] <- 1
  net.elwd <- (abs(cn.mu.plot[[i]]) * 10)^2
  set.seed(123)
  gplot(abs(cn.mu.plot[[i]]),
    gmode = "digraph",
    displaylabels = TRUE,
    coord = coord,
    edge.lwd = net.elwd,
    edge.col = net.col,
    vertex.col = "black",
    vertex.cex = 0.5,
    arrowhead.cex = 0.5,
    label.cex = 1,
    main = names(cn.mu.plot)[i]
  )
}
```

## Figure: Genotype network similarity by genotype
```{r cn_chplot, height = 8, width = 8}

par(mfrow = c(1, 1), mar = c(5.1, 4.1, 4.1, 2.1))
chp.coord <- ch.plot(cn.nms.onc, onc.geno,
  cex = 2.65, lwd = 2.5, mu.pch = 15,
  pt.col = "white",
  bar.col = "darkgrey"
)
text(chp.coord, labels = rownames(chp.coord), cex = 0.65)
plot(vec.cn, col = "black", lwd = 5)
```

## Figure: A) Lichen networks

## Figure: (A) Linkage and centrality by genotype and (B) Total
##   cover and species richness predict L and Cen
```{r cn_metrics, height = 8, width = 9}

mdc.plot(onc.dat[, "geno"], onc.dat[, "L"],
  ylim = c(-1, 1.75),
  xlab = "Tree Genotype", ylab = "Standardized Metric",
  ord = order(tapply(onc.dat[, "L"], 
                     onc.dat[, "geno"], mean), 
              decreasing = TRUE)
)
mdc.plot(onc.dat[, "geno"], onc.dat[, "Cen"],
  add = TRUE, pch = 1,
  ord = order(tapply(onc.dat[, "L"], 
                     onc.dat[, "geno"], mean), 
              decreasing = TRUE)
)
legend("topright", 
       legend = c("Links", "Centralization"), 
       pch = c(19, 1), bty = "none")

```


## Supplementary Figure: Lichen size distribution
```{r xg_size, height = 5, width = 5}

plot(density(xgs.data$median.thallus),
  xlab = "Median Lichen Thallus Area (cm^2)",
  main = ""
)
abline(v = median(xgs.data$median.thallus, na.rm = TRUE), lty = 2)
```


### Figure 2
```{r cn_chplot_onc, height = 5, width = 12}

par(mfrow = c(1, 2), mar = c(5.1, 4.1, 4.1, 2.1) / 2)
gplot(meanNet(cn.mu.onc),
  gmode = "graph",
  displaylabels = TRUE,
  edge.lwd = meanNet(cn.mu.onc) * 20,
  vertex.col = "darkgrey"
)
legend("topleft", legend = "A", bty = "n", cex = 1.5)
chp.coord <- ch.plot(cn.nms.onc, onc.geno, cex = 1.5)
plot(nv.onc, col = "darkgrey")
legend("topleft", legend = "B", bty = "n", cex = 1.5)
```

```{r bp_net_onc}

par(mfrow = c(1, 1), mar = c(5.1, 4.1, 4.1, 2.1))
bipartite::plotweb(pw.onc,
  method = "normal",
  text.rot = 45,
  col.low = col.pal[mods.onc$tree],
  col.high = col.pal[mods.onc$sp],
  bor.col.low = col.pal[mods.onc$tree],
  bor.col.high = col.pal[mods.onc$sp],
  col.interaction = "grey70",
  bor.col.interaction = "grey70",
  labsize = 1.5
)
```

```{r chp_com_onc}

ch.plot(nms.onc, onc.geno)
## plot(cv.onc, col = "grey30")
## legend("topleft", legend = "A")
```



```{r connect_geno, width = 12, height = 7}

g.order <- tapply(ns.onc[, "C"], onc.geno, mean)
g.order <- names(g.order)[order(g.order, decreasing = TRUE)]
onc.g <- factor(onc.geno, levels = g.order)
plot(ns.onc[, "C"] ~ onc.g, 
     xlab = "Tree Genotype", 
     ylab = "Lichen Network Connectance (C)")

```

## Which wild uintah trees are similar to garden trees?

```{r cn_chplot_all, width = 5, height = 7}

coords <- ch.plot(cn.nms.all, cn.nms.geno, mu.pch = "", cex = 2)
points(coords, pch = 19, col = "white", cex = 2)
text(coords[!grepl("wild", rownames(coords)), ],
  labels = rownames(coords)[!grepl("wild", rownames(coords))],
  col = "black"
)
text(coords[grep("wild", rownames(coords)), 1],
  coords[grep("wild", rownames(coords)), 2],
  labels = "Wild", col = "red"
)
plot(vec.all, col = "black", cex = 1.23)
```

# Send results to manuscript

```{r }

manuscript.dir <- "../../lcn_manuscript"
### Send tables and figures to manuscript directory
if (exists("manuscript.dir")) {
  tabs.figs <- dir(manuscript.dir)
  tab.fig.update <- dir("../results/lcn_notebook_files/figure-latex/",
    full.names = TRUE
  )[
    dir("../results/lcn_notebook_files/figure-latex/") %in% tabs.figs
  ]
  tab.fig.update <- c(
    tab.fig.update,
    dir("../docs", full.names = TRUE)[dir("../docs") %in% tabs.figs]
  )
  sapply(tab.fig.update, 
         file.copy, 
         to = manuscript.dir, overwrite = TRUE)
  # supplementary figures
  si.dir <- paste0(manuscript.dir, "/supplement")
  si <- dir(si.dir)
  si.update <- dir("../results/lcn_notebook_files/figure-latex/",
    full.names = TRUE
  )[
    dir("../results/lcn_notebook_files/figure-latex/") %in% si
  ]
  si.update <- c(si.update, 
                 dir("../docs", 
                     full.names = TRUE)[dir("../docs") %in% si])
  sapply(si.update, file.copy,
    to = si.dir,
    overwrite = TRUE
  )
}
```

